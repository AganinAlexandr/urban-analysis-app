# Техническое задание на разработку приложения
## "Извлечение и анализ данных из файлов по программе городская среда"

### 1. ОБЩИЕ СВЕДЕНИЯ

#### 1.1 Назначение системы
Разработка клиентского приложения для извлечения, обработки и анализа данных отзывов о городской среде с возможностью визуализации результатов на карте и в виде аналитических диаграмм.

#### 1.2 Тип приложения
- **Архитектура**: Клиентское приложение без серверной части
- **Платформа**: Desktop-приложение (Windows)
- **Язык программирования**: Python
- **Интерфейс**: Графический пользовательский интерфейс (GUI)

#### 1.3 Целевые пользователи
- Аналитики городской среды
- Исследователи социальных данных
- Административные работники

### 2. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

#### 2.1 Управление архивными данными

##### 2.1.1 Архивный файл результатов
- **Формат**: CSV файл с кодировкой UTF-8
- **Назначение**: Хранение обработанных данных отзывов
- **Структура**: Исходные данные + результаты обработки

##### 2.1.2 Добавление новых данных
- **Функция**: Добавление обработанных отзывов к архивному файлу
- **Проверка дубликатов**: Предотвращение повторного добавления существующих отзывов
- **Ключ уникальности**: Хэш-ключ, формируемый из комбинации полей

##### 2.1.3 Поля для формирования ключа
Предлагаемые поля для хэш-ключа:
- Группа объекта
- Название объекта  
- Адрес объекта
- user_name
- Дата отзыва
- Первые 10 символов текста отзыва

**Особенности формирования ключа для сложных отзывов:**
- При разделении сложного отзыва на части используется одинаковый базовый хэш
- Для положительной части добавляется суффикс "_p"
- Для отрицательной части добавляется суффикс "_n"
- Это обеспечивает уникальность ключей для каждой части отзыва

##### 2.1.4 Управление архивом
- **Очистка архива**: Возможность полной очистки содержимого архивного файла
- **Информация об архиве**: Отображение статистики:
  - Количество отзывов по группам объектов
  - Минимальная и максимальная даты отзывов
  - Общее количество записей

#### 2.2 Обработка входных данных

##### 2.2.1 Поддерживаемые форматы
- **JSON файлы**: Основной формат входных данных
- **CSV файлы**: Альтернативный формат
- **Структура папок**: Организация по источникам (2gis, yandex, другие)

##### 2.2.2 Методы обработки
**1. Классические методы ML:**
- NLTK и VADER для анализа сентиментов
- Классификация отзывов (положительные, отрицательные, нейтральные)
- Определение типов отзывов (благодарность, жалоба, предложение, информационный)
- Разделение сложных отзывов на части

**2. Большие языковые модели:**
- OpenAI GPT (GPT-3.5-turbo, GPT-4)
- Google Gemini Pro
- YandexGPT Lite
- GigaChat
- Qwen Turbo
- DeepSeek Chat

##### 2.2.3 Выбор методов обработки
- **Интерфейс выбора**: Возможность выбора группы методов/моделей
- **Проверка доступности**: Учет наличия API ключей и подключения
- **Сравнительный анализ**: Сравнение результатов разных методов

#### 2.3 Валидация данных

##### 2.3.1 Проверка обязательных полей
**Минимальные требования для обработки:**
- Группа объекта (поле №1)
- Текст отзыва (поле №7)

**Минимальные требования для сохранения в архив:**
- Группа объекта (поле №1)
- Название объекта (поле №2)
- Адрес объекта (поле №3)
- Текст отзыва (поле №7)
- Дата отзыва (поле №11)

##### 2.3.2 Обработка безадресных отзывов
- **Ограничение**: Отзывы без адреса не сохраняются в архив
- **Отображение**: Результаты безадресных отзывов выводятся только на экран
- **Уведомление**: Информирование пользователя о количестве исключенных записей

#### 2.4 Геокодирование и картография

##### 2.4.1 Геокодирование адресов
- **Сервис**: Яндекс.Геокодер API
- **Функция**: Определение координат объектов из адресов
- **Логика обработки**:
  - Проверка наличия полей latitude и longitude в загружаемых данных
  - Если координаты отсутствуют - выполнение геокодирования
  - Если координаты уже есть - пропуск геокодирования для исключения повторной работы
- **Результат**: Добавление полей latitude и longitude (только при их отсутствии)

##### 2.4.2 Интеграция с картами
- **Платформа**: Яндекс.Карты
- **Функции**:
  - Отображение объектов на карте
  - Слои по группам объектов
  - Выборочное отображение слоев
  - Информационные окна с данными объектов

#### 2.5 Анализ данных

##### 2.5.1 Анализ сентиментов
- Определение эмоциональной окраски текстов отзывов
- Классификация на положительные, отрицательные и нейтральные
- Определение типов отзывов (благодарность, жалоба, предложение, информационный)

##### 2.5.2 Проверка соответствия
- Проверка соответствия текста отзыва указанной группе объекта
- Анализ релевантности классификации

##### 2.5.4 Векторизация и кластеризация отзывов
- **Векторизация текстов**: Преобразование отзывов в векторные представления
- **Методы векторизации**:
  - Word2Vec для русского текста
  - LLM embeddings (OpenAI, YandexGPT, Gemini)
  - Sentence Transformers
- **Кластеризация**: Группировка схожих отзывов без предварительной разметки
- **Алгоритмы кластеризации**:
  - K-means
  - DBSCAN
  - Агломеративная кластеризация
  - Иерархическая кластеризация
- **Обоснование кластеризации**: Сомнения в качестве оценок отзывов в исходных данных
- **Интерактивная визуализация кластеров**: 3D диаграммы с Plotly
  - Вращение, масштабирование и навигация
  - Цветовая кодировка кластеров
  - Информационные подсказки
  - Выделение отдельных кластеров

##### 2.5.3 Разделение сложных отзывов
- Выявление отзывов с смешанной тональностью
- Разделение на положительные и отрицательные части
- Анализ каждой части как отдельного отзыва
- Формирование уникальных ключей для каждой части (базовый хэш + суффикс "_p"/"_n")

### 3. СТРУКТУРА ДАННЫХ

#### 3.1 Группы объектов
Поддерживаемые группы объектов:
- resident_complexes (жилые комплексы)
- school (школы)
- hospital (больницы)
- pharmacy (аптеки)
- kindergarden (детские сады)
- polyclinic (поликлиники)
- university (университеты)
- shopmall (торговые центры)

#### 3.2 Поля входных данных
**Обязательные поля:**
1. Группа объекта
2. Название объекта (name, founded.name)
3. Адрес объекта
4. Текст отзыва
5. Дата отзыва (date)

**Опциональные поля:**
6. Рейтинг объекта (rating, average_rating)
7. Счетчик запросов API (review_count_from_api)
8. review_count_fetched
9. Рейтинг отзыва (star, stars)
10. Текст ответа (answer)
11. Имя пользователя (user_name, name)
12. Координаты объекта (latitude, longitude) - если отсутствуют, будут получены автоматически

#### 3.3 Обработка дат
- **Форматы**: Стандартные форматы дат
- **Относительные даты**: Обработка текстов вида "пять месяцев назад"
- **Базовая дата**: 01.05.2025 для расчета относительных дат

### 4. ВИЗУАЛИЗАЦИЯ ДАННЫХ

#### 4.1 Табличные представления
- Сравнение результатов обработки разными методами
- Статистика по группам объектов
- Анализ корреляций между параметрами

#### 4.2 Графические диаграммы

##### 4.2.1 Распределения по источникам
1. Гистограмма количества объектов по группам и источникам (2gis, yandex, другие)
2. Гистограмма количества отзывов по группам и источникам

##### 4.2.2 Распределения по административному делению
3. Гистограмма количества объектов по группам и административным округам
4. Гистограмма количества отзывов по группам и административным округам

##### 4.2.3 Анализ качества данных
5. Гистограмма заполненности данных (рейтинг отзыва, текст отзыва, текст ответа)
6. Гистограмма распределения рейтингов отзывов по группам и источникам

##### 4.2.4 Тепловые карты
7. Таблица средних рейтингов по округам, районам и группам объектов
8. Диаграмма корреляции рейтинга отзыва и embeddings

##### 4.2.5 Анализ контента
9. Диаграмма зависимости типа сообщения от группы объекта
10. Визуализация ключевых слов по группам и источникам

##### 4.2.6 Векторизация и кластеризация
11. Диаграмма векторов (эмбедингов) отзывов, полученных разными методами:
    - Word2Vec векторы
    - LLM embeddings (OpenAI, YandexGPT, Gemini)
    - Sentence Transformers
12. **Интерактивная визуализация кластеров**:
    - 3D диаграммы с использованием Plotly
    - Возможность вращения, масштабирования и навигации
    - Цветовая кодировка кластеров
    - Информационные подсказки при наведении на точки
    - Возможность выделения отдельных кластеров
13. Сравнительная диаграмма качества кластеризации для разных методов векторизации

### 5. ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ

#### 5.1 Системные требования
- **ОС**: Windows 10/11
- **Python**: 3.7+
- **Память**: Минимум 4 ГБ RAM
- **Дисковое пространство**: 2 ГБ для установки

#### 5.2 Зависимости
Основные библиотеки:
- pandas, numpy - обработка данных
- matplotlib, seaborn - статическая визуализация
- plotly - интерактивная визуализация (3D диаграммы, кластеры)
- nltk, gensim - анализ текста
- scikit-learn - машинное обучение и кластеризация
- openai, google-generativeai - LLM API
- yandexcloud, gigachat - российские LLM
- dashscope, deepseek - дополнительные LLM
- sentence-transformers - векторизация текстов
- umap-learn - снижение размерности для визуализации
- hdbscan - плотностная кластеризация

#### 5.3 API ключи
Необходимые API ключи:
- Яндекс.Геокодер
- OpenAI API
- Google Gemini API
- YandexGPT API
- GigaChat API
- Qwen API
- DeepSeek API

### 6. ИНТЕРФЕЙС ПОЛЬЗОВАТЕЛЯ

#### 6.1 Главное окно
- Меню выбора файлов для обработки
- Панель выбора методов анализа
- Кнопки управления архивом
- Область отображения результатов

#### 6.2 Панели управления
- **Панель файлов**: Выбор входных файлов и папок
- **Панель методов**: Выбор методов обработки
- **Панель архива**: Управление архивным файлом
- **Панель карты**: Управление отображением на карте

#### 6.3 Области отображения
- **Таблицы**: Результаты обработки и статистика
- **Диаграммы**: Графические представления данных
- **Интерактивные диаграммы**: 3D визуализации кластеров с Plotly
- **Карта**: Интерактивная карта с объектами
- **Лог**: Информация о процессе обработки

### 7. АРХИТЕКТУРА ПРИЛОЖЕНИЯ

#### 7.1 Модульная структура
```
app/
├── core/                 # Основные модули
│   ├── data_processor.py # Обработка данных
│   ├── text_analyzer.py  # Анализ текста
│   ├── llm_analysis.py   # LLM анализ
│   ├── geocoder.py       # Геокодирование
│   ├── vectorizer.py     # Векторизация текстов
│   └── clusterer.py      # Кластеризация
├── gui/                  # Пользовательский интерфейс
│   ├── main_window.py    # Главное окно
│   ├── panels/           # Панели управления
│   └── widgets/          # Виджеты
├── visualization/        # Визуализация
│   ├── charts.py         # Диаграммы
│   ├── maps.py           # Карты
│   ├── tables.py         # Таблицы
│   └── embeddings.py     # Визуализация эмбедингов
├── utils/                # Утилиты
│   ├── file_utils.py     # Работа с файлами
│   ├── hash_utils.py     # Хэширование
│   └── config.py         # Конфигурация
└── data/                 # Данные
    ├── archives/         # Архивные файлы
    ├── results/          # Результаты
    └── temp/             # Временные файлы
```

#### 7.2 Принципы разработки
- **Модульность**: Разделение на независимые компоненты
- **Декомпозиция**: Разбиение сложных задач на простые
- **Читаемость**: Простой и понятный код
- **Расширяемость**: Возможность добавления новых функций

### 8. ТРЕБОВАНИЯ К КАЧЕСТВУ

#### 8.1 Производительность
- Обработка файлов размером до 1 ГБ
- Время обработки: не более 5 минут на 10,000 записей
- Отзывчивость интерфейса при работе с большими данными

#### 8.2 Надежность
- Обработка ошибок и исключений
- Валидация входных данных
- Резервное копирование архивных файлов
- Логирование операций

#### 8.3 Безопасность
- Безопасное хранение API ключей
- Валидация файлов перед обработкой
- Защита от переполнения буфера

### 9. ДОКУМЕНТАЦИЯ

#### 9.1 Пользовательская документация
- Руководство пользователя
- Справочник по функциям
- Примеры использования

#### 9.2 Техническая документация
- Описание архитектуры
- API документация
- Руководство по развертыванию

### 10. ПЛАН РАЗРАБОТКИ

#### 10.1 Этапы разработки
1. **Этап 1**: Базовая архитектура и обработка данных (2 недели)
2. **Этап 2**: Пользовательский интерфейс (2 недели)
3. **Этап 3**: Интеграция с картами и визуализация (2 недели)
4. **Этап 4**: Тестирование и оптимизация (1 неделя)
5. **Этап 5**: Документация и финальная сборка (1 неделя)

#### 10.2 Критерии приемки
- Все функциональные требования реализованы
- Интерфейс интуитивно понятен
- Приложение стабильно работает с большими объемами данных
- Документация полная и актуальная

---

**Версия документа**: 1.0  
**Дата создания**: 2024  
**Статус**: Черновик 